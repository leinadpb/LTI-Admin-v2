<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LTI Admin V2 - Admin Panel</title>
    <link rel="stylesheet" href="../style/index.css" />
    <link rel="stylesheet" href="./styles/start.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" >
    <style>
      
      .page-wrapper {
        width: 100%;
        height: 100vh;
        display: grid;
        grid-template-columns: 1fr 4fr;
        grid-template-rows: 1fr 5fr;
        grid-template-areas: 
          "header header"
          "sidebar main";
        overflow: hidden;
      }
      .header {
        grid-area: header;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-rows: auto;
        grid-template-columns: 1fr 5fr 1fr;
        background: linear-gradient(to right, #911313, #b51818);
      }
      .logo-box {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .logo-box > img {
        width: 60%;
        height: 50%;
        object-fit: scale-down;
        filter: grayscale(100%) brightness(10);
      }
      .title-box {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .title-box > .main-title {
        width: 100%;
        text-align: center;
        padding: 8px;
      }
      .title-box > .main-title > h2 {
        font-weight: 400;
        color: rgba(255,255,255,0.98);
      }
      .user-box {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .user-box > .username {
        padding: 8px;
      }
      .user-box > .username > b {
        font-size: 0.8rem;
        color: rgba(255,255,255,1);
      }
      .user-box > .username > b > span {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.9);
      }
      .sidebar {
        grid-area: sidebar;
        width: 100%;
        height: 100%;
        max-height: 100%;
        overflow: auto;
        display: flex;
        flex-direction: column;
        box-shadow: 0px 0px 8px 2px rgb(0, 0, 0, 0.08);
      }
      .sidebar > .menu-options {
        width: 100%;
        display: flex;
        flex-direction: column;
        margin-top: 24px;
      }
      .menu-option {
        width: 100%;
        display: grid;
        grid-template-columns: 2px auto;
        grid-template-rows: auto;
        cursor: pointer;
        transition: all 0.2s;
      }
      .menu-option:hover .menu-option-label span  {
        color: white;
      }
      .menu-option:hover  {
        background: #911313;
      }
      .menu-option-indicator-on {
        width: 100%;
        height: 100%;
        background-color: #b51818;
      }
      .menu-option-indicator-off {
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.30);
      }
      .menu-option > .menu-option-label {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px;
      }
      .menu-option > .menu-option-label > span {
        transition: all 0.2s;
        color: #911313;
      }

      .home-content {
        grid-area: main;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .signs-content {
        grid-area: main;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }
      .survey-content {
        grid-area: main;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }
      .rules-content {
        grid-area: main;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }

      .main-content {
                
          max-height: 100%;
          overflow:hidden;
          margin-left: 3%;
                } 
  
.inner {
	overflow: hidden;
}
.inner img {
	transition: all 1.5s ease;
}
.inner:hover img {
	transform: scale(1.5);
}



   .config-content {
        grid-area: main;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }
      .config-normas{
        width: 50%;
        height: 50%;
        
      }
      

      .config-title {
      margin: 2%;
      text-align: center;
      font-size: 25px;
      }
      .rules-title {
        margin: 3%;
        font-size: 20px;
        text-align: center;
      }
    
    .config-content input[type="checkbox"] {
      margin-left: 10px;
      position: relative;
      width: 40px;
      height: 20px;
     -webkit-appearance: none;
     background: #c6c6c6;
     outline: none;
     border-radius:20px;
     box-shadow: inset 0 0 5px rgba(0,0,0 .2);
      transition: .5s;
     }
     .config-content input:checked[type="checkbox"]{
       
       background: #03a9f4;
     }
     .config-content input[type="checkbox"]:before {
       content: '';
       position: absolute;
       width: 20px;
       height:20px;
       border-radius: 20px;
       top:0;
       left: 0;
       background: #fff;
       transition: .5s;
       transform: scale(1.1);
       box-shadow: 0 2px 5px rgba(0,0,0, .2);
     }
     .config-content input:checked[type="checkbox"]:before{
       left: 20px;
     }

     .config-content .checkbox label {
       color: #000;
       padding: 5px 50px 5px 15px;
       display: inline-block;
       position: relative;
       border-radius: 10px;
       cursor:pointer;
       transition: all 0.5s ease;
     }
     .config-content .checkbox label:hover {
       background: rgba(19, 128, 190, 0.1);
     }
     /* circulo
     .config-content .checkbox label:before {
       content: "";
       width: 17px;
       height: 17px;
       display:inline-block;
       background: none;
       border: 3px solid rgb(29, 27, 27);
       border-radius: 50%;
       position: absolute;
       left: 17px;
       top:4px;

     * border rojo *
     .config-content .checkbox label:before {
       border-radius: 3px;
     }
     .config-content input[type="checkbox"]:checked + label {
       padding:5px 15px;
       background: #911313;
       border-radius: 10px;
       color: #fff;
     }
     */

    .comments {margin: 10px;}
    .text-comments {
      margin:15px;
      font-size: 15px;  
    }
    textarea{
      border-radius: 5px;
      font-family: arial;
      min-height: 50px;
      max-height: 70px;
      min-width: 80%;
      max-width: 100%;
    }
    .select {
      font-family: arial;
      width: 80%;
      border-radius: 5px;
      margin:10px;
      
    };

   


      /* Media queries */

    </style>
  </head>
  <body>
    <div class="page-wrapper">
      <div class="header">
        <div class="logo-box">
          <img src="../../public/images/logo-intec-primario.png" />
        </div>
        <div class="title-box">
          <div class="main-title">
            <h2>LABTI Admin V2</h2>
          </div>
        </div>
        <div class="user-box">
          <div class="username">
            <b><span id="user-label"></span></b>
          </div>
        </div>
      </div>
      <div class="sidebar">
        <div class="menu-options">
          <div class="menu-option" onclick="menuOptionClick(this, 'home')">
            <div class="menu-option-indicator-on"></div>
            <div class="menu-option-label">
              <span>
                Inicio
              </span>
            </div>
          </div>
          <div class="menu-option" onclick="menuOptionClick(this, 'signs')">
            <div class="menu-option-indicator-off"></div>
            <div class="menu-option-label">
              <span>
                Firmas
              </span>
            </div>
          </div>
          <div class="menu-option" onclick="menuOptionClick(this, 'survey')">
            <div class="menu-option-indicator-off"></div>
            <div class="menu-option-label">
              <span>
                Encuestas
              </span>
            </div>
          </div>
          <div class="menu-option" onclick="menuOptionClick(this, 'rules')">
            <div class="menu-option-indicator-off"></div>
            <div class="menu-option-label">
              <span>
                Reglas LABTI
              </span>
            </div>
          </div>
          <div class="menu-option" onclick="menuOptionClick(this, 'config')">
            <div class="menu-option-indicator-off"></div>
            <div class="menu-option-label" id="settings">
              <span>
                Configuración
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="home-content" id="home">
        <div class="main-content" id="main-content">
          <div class="row mt-3 justify-content-center">
            <div class="col-12 col-sm-6 col-lg-4 mb-4">
              <div class="card shadow" style="width: 15rem; height: 15rem;">
                <div class="inner">
                  <img class="card-img-top"  style="width: 4rem; margin-left: 37%" src="../../public/images/calendar.png" alt="Card image cap">
                </div>
                  
                  <div class="card-body text-center">
                    <h6 class="card-title">Gestion de trimestres</h6><hr>
                    <p class="card-text">Crear y modificar los trimestres, debes crear el trimestre correspondiente.</p>
                    
                  </div>
                </div>
            </div>
      
      
            <div class="col-12 col-sm-6 col-lg-4 mb-4">
              <div class="card shadow" style="width: 15rem; height: 15rem;">
                <div class="inner">
                  <img class="card-img-top"  style="width: 21%; margin-left: 40%" src="../../public/images/loupe.png" alt="Card image cap">
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Busqueda Avanzada.</h6><hr>
                    <p class="card-text">Filtra los estudiantes por trimestre, asignatura, profesor y por nombre o matricula. </p>
                   
                  </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-6 col-lg-4 mb-4">
              <div class="card shadow" style="width: 15rem; height: 15rem;">
                <div class="inner">
                  <img class="card-img-top"  style="width: 21%; margin-left: 40%" src="../../public/images/admin.png" alt="Card image cap">
                </div>
                  
                  <div class="card-body text-center">
                    <h6 class="card-title">Agrega administradores.</h6><hr>
                    <p class="card-text">A los administradores no se les mostrara ningun formulario ni ventana de Normas LTI. </p>
                    
                  </div>
                </div>
            </div>
  
            <div class="col-md-12 col-sm-6 col-lg-4 mb-4">
              <div class="card shadow" style="width: 15rem; height: 15rem;">
                <div class="inner">
                  <img class="card-img-top"  style="width: 21%; margin-left: 40%" src="../../public/images/normas.png" alt="Card image cap">
                </div>
                  
                  <div class="card-body text-center">
                    <h6 class="card-title">Gestion de Normas.</h6><hr>
                    <p class="card-text">Crear, modificar y eliminar las Normas. </p>
                    
                  </div>
                </div>
            </div>
  
            <div class="col-md-12 col-sm-6 col-lg-4 mb-6">
              <div class="card shadow" style="width:15rem; height: 15rem;">
                <div class="inner">
                  <img class="card-img-top"  style="width: 20%; margin-left: 40%" src="../../public/images/configuracion.png" alt="Card image cap">
                </div>
                  
                  <div class="card-body text-center">
                    <h6 class="card-title">Configuraciones Generales.</h6><hr>
                    <p class="card-text">Cambia las configuraciones para el despliegue de las Normas y encuestas. </p>
                    
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
      <div class="signs-content" id="signs">
        <div class="filter-panel">
          <div class="filter-option">
            <div><span>Asignatura: </span></div>
            <div>
              <select name="subject-list" id="subject-list" class="form-control">
                <option value="-1">Seleccione...</option>
              </select>
            </div>
          </div>
          <div class="filter-option">
            <div><span>Profesor: </span></div>
            <div>
              <select name="teacher-list" id="teacher-list" class="form-control">
                <option value="-1">Seleccione...</option>
              </select>
            </div>
          </div>
          <div class="filter-option">
            <div><span>Trimestre: </span></div>
            <div>
              <select name="trimester-list" id="trimester-list" class="form-control">
                <option value="-1">Seleccione...</option>
              </select>
            </div>
          </div>
          <div class="filter-option">
            <div><span>ID: </span></div>
            <div>
              <input class="form-control" type="text" id="student-id" />
            </div>
          </div>
          <div class="filter-button">
            <button class="btn btn-secondary btn-sm" onclick="cleanFilters()">Limpiar</button>
            <button class="btn btn-primary btn-sm" onclick="applyFilters()">Filtrar</button>
          </div>
        </div>
        <div class="table-wrapper table">
          <table class="table table-bordered table-hover">
            <thead class="thead-dark">
              <tr>
                <th style="text-align: center; vertical-align: middle;">
                  ID
                </th>
                <th style="text-align: center; vertical-align: middle;">
                  Nombre
                </th>
                <th style="text-align: center; vertical-align: middle;">
                  Asignatura
                </th>
                <th style="text-align: center; vertical-align: middle;">
                  Profesor
                </th>
                <th style="text-align: center; vertical-align: middle;">
                  Sección
                </th>
                <th style="text-align: center; vertical-align: middle;">
                  Trimestre
                </th>
              </tr>
            </thead>
            <tbody id="stduents-data" class="table-striped"></tbody>
          </table>
        </div>
      </div>
      <div class="survey-content" id="survey">
        Survey content
      </div>
      <div class="rules-content" id="rules">
        <div class="header">
          <span style="margin-right: 16px;">Reglas del LABTI - INTEC</span>
          <button class="btn btn-primary btn-sm" onclick="createRule()">Crear</button>
        </div>
        <div class="table-wrapper">
          <table class="table table-bordered table-hover">
            <thead class="thead-dark">
              <th>No.</th>
              <th>Regla</th>
              <th></th>
            </thead>
            <tbody id="rules-data" class="table-striped"></tbody>
          </table>
        </div>
      </div>
      <div class="config-content" id="config">
        <h2 class ="config-title">Configuraciones</h2>

        <div class="config-normas">
          <h3 class="rules-title">Normas</h3>
          <hr>
          <!--Checkbox-->
            <div class="checkbox">
              <input type="checkbox" class="normas"  id="checkbox1">
              <label for="checkbox1">Permitir aceptar las normas del laboratorio</label>
              <br>
              <input type="checkbox" class="normas"  id="checkbox2">
              <label for="checkbox2">Permitir seleccionar asignatura y/o profesor.</label>
              <br>
              <input type="checkbox" class="normas"  id="checkbox3" for="checkbox3">
              <label for="checkbox3">Mostrar recordatorio de las tres normas principales.</label>
            </div>
            <!--comment box-->
            <div class="comments">
              <p class="text-comments">Mensaje en el recordatorio:</p>
              <textarea name="mensaje" id="recordatorio"  placeholder="Las violaciones a cualquiera de estas normas pueden acarrear sanciones académicas."></textarea>
            </div>
            <!--Printer-->
              <div class="printer">
                <h3 class="rules-title">Impresora</h3>
                <hr>
                  <select class="select">
                    <option value="0">Seleccione</option>
                    <option value="Send To OneNote 16">Send To OneNote 16</option>
                    <option value="OneNote">OneNote</option>
                    <option value="PrimoPDF">PrimoPDF</option>
                    <option value="Microsoft XPS Document Writer">Microsoft XPS Document Writer</option>
                    <option value="Microsoft Print to PDF">Microsoft Print to PDF</option>
                    <option value="LABTIPrinter">LABTIPrinter</option>
                    <option value="Fax">Fax</option>
                  </select>
              </div>
        </div>

         
        
      </div>
      
    <script>
      const ipcRenderer = require('electron').ipcRenderer;
      const studentFields = ['intecId', 'name', 'subject', 'teacher', 'section', 'trimesterName'];
      const rulesFields = ['number', 'text', 'actions'];

      let windowData = undefined;
      ipcRenderer.send('main-request-data', {});
      ipcRenderer.on('main-request-data-response', (e, args) => {
        windowData = args;
        document.getElementById('user-label').innerHTML = windowData.user.name;
        console.log('Window data: ', windowData);
        // Call init fucntions
        getUnfilteredData();
        getRulesData();
        setSelectData('subject-list', windowData.subjects.map(x => {
          return {
            value: x.code,
            text: x.name
          }
        }));
        let teachers = [];
        windowData.subjects.forEach(fs => {
          let subTeachers = fs.teacherAssigned.split(';');
          subTeachers.forEach(st => {
            teachers.push(st);
          })
        })
        setSelectData('teacher-list', teachers.map(x => {
          if (!!x && x.length > 0) {
            return {
              value: x,
              text: x
            }
          }
        }));
        setSelectData('trimester-list', windowData.trimesters.map(x => {
          return {
            value: x.name,
            text: x.name
          }
        }));
      });
      ipcRenderer.on('fetch-students-response', (e, args) => {
        let students = args;
        console.log('Obtained students >>>>>>>>', students);
        renderStudents(students);
      })

      // Functions
      const options = ['home', 'survey', 'signs', 'rules', 'config'];
      function menuOptionClick(e, key) {
        options.forEach(opt => {
          document.getElementById(opt).style.display = "none";
        });
        let menuOptions = document.getElementsByClassName("menu-option");
        for(let i = 0; i < menuOptions.length; i++) {
          opt = menuOptions[i]
          opt.children[0].style.background = "rgba(0, 0, 0, 0.30)";
        }
        document.getElementById(key).style.display = "inline-block";
        e.children[0].style.background = "#b51818";
      }

      // Rules
      ipcRenderer.on('refresh-rules', (e, args) => {
        console.log('refresing.....', args);
        renderRules(args.sort(function(a, b) { return a.number - b.number }));
      })
      const createRule = () => {
        ipcRenderer.send('open-add-rules', {});
      }
      const getRulesData = () => {
        let rules = windowData.rules.sort(function(a, b) { return a.number - b.number });
        console.log(rules);
        renderRules(rules);
      }
      function renderRules(rules) {
        let data = document.getElementById('rules-data');
        // Clean list
        while (data.firstChild) {
          data.removeChild(data.firstChild);
        } // End cleaning
        for(let i = 0; i < rules.length; i++) {
          let s = rules[i];
          let tr = document.createElement('tr');
          for(let j = 0; j < rulesFields.length; j++) {
            let field = rulesFields[j];
            let td = document.createElement('td');
            td.align = "center";
            if (field === 'actions') {
              // class="btn btn-secondary btn-sm" onclick="cleanFilters()"
              let editBtn = document.createElement('button');
              let deleteBtn = document.createElement('button');
              editBtn.classList = "btn btn-secondary btn-sm";
              editBtn.onclick = () => {
                ipcRenderer.send('open-edit-rules', {rule: rules[i]});
                console.log('Will edit rule: ', rules[i]);
              }
              editBtn.innerHTML = "Editar";
              deleteBtn.classList = "btn btn-secondary btn-sm";
              deleteBtn.onclick = () => {
                ipcRenderer.send('open-delete-rules', {rule: rules[i]});
                console.log('Will remove rule: ', rules[i]);
              }
              deleteBtn.innerHTML = "Eliminar";

              let btnsWrapper = document.createElement('div');
              btnsWrapper.classList = "btn-actions";
              btnsWrapper.appendChild(editBtn);
              btnsWrapper.appendChild(deleteBtn);
              td.appendChild(btnsWrapper);
            } else {
              td.innerHTML = s[field];
            }
            
            tr.appendChild(td);
          }
          data.appendChild(tr);
        }
      }

      // Signs
      const getUnfilteredData = async () => {
        let students = windowData.allStudents;
        console.log(students);
        renderStudents(students);
      }
      function renderStudents(students) {
        let data = document.getElementById('stduents-data');
        // Clean list
        while (data.firstChild) {
          data.removeChild(data.firstChild);
        } // End cleaning
        for(let i = 0; i < students.length; i++) {
          let s = students[i];
          console.log('Student: >>>', s);
          let tr = document.createElement('tr');
          for(let j = 0; j < studentFields.length; j++) {
            let field = studentFields[j];
            let td = document.createElement('td');
            td.align = "center";
            td.innerHTML = s[field];
            tr.appendChild(td);
          }
          data.appendChild(tr);
        }
      }
      function setSelectData(id, dataList) {
        let select = document.getElementById(id);
        dataList.forEach(data => {
          let option = document.createElement('option');
          option.value = data.value;
          option.innerHTML = data.text;
          select.appendChild(option);
        })
      }
      function cleanFilters() {
        let teacherFilter = document.getElementById('teacher-list');
        let subjectFilter = document.getElementById('subject-list');
        let trimesterFilter = document.getElementById('trimester-list');
        let idFilter = document.getElementById('student-id');
        teacherFilter.value = "-1";
        subjectFilter.value = "-1";
        trimesterFilter.value = "-1";
        idFilter.value = "";

        applyFilters();
      }
      function applyFilters() {
        let teacherFilter = document.getElementById('teacher-list');
        let subjectFilter = document.getElementById('subject-list');
        let trimesterFilter = document.getElementById('trimester-list');
        let idFilter = document.getElementById('student-id');
        let filtersToApply = [];
        if (teacherFilter.value !== "-1") filtersToApply.push({key: 'teacher', value: teacherFilter.value});
        if (subjectFilter.value !== "-1") filtersToApply.push({key: 'subject', value: subjectFilter.value});
        if (trimesterFilter.value !== "-1") filtersToApply.push({key: 'trimesterName', value: trimesterFilter.value});
        if (idFilter.value !== "") filtersToApply.push({key: 'intecId', value: idFilter.value});
        let filterObject = {};
        filtersToApply.forEach(filter => {
          filterObject[filter.key] = filter.value;
        });
        ipcRenderer.send('fetch-students', {filterObject: filterObject});
      }
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
